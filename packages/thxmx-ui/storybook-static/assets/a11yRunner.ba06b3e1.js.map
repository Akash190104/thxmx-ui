{"version":3,"file":"a11yRunner.ba06b3e1.js","sources":["../../../../node_modules/@storybook/addon-a11y/dist/esm/a11yRunner.js"],"sourcesContent":["import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport global from 'global';\nimport { addons } from '@storybook/addons';\nimport { EVENTS } from './constants';\nvar document = global.document,\n    globalWindow = global.window;\n\nif (module && module.hot && module.hot.decline) {\n  module.hot.decline();\n}\n\nvar channel = addons.getChannel(); // Holds axe core running state\n\nvar active = false; // Holds latest story we requested a run\n\nvar activeStoryId;\n\nvar getElement = function getElement() {\n  var storyRoot = document.getElementById('story-root');\n  return storyRoot ? storyRoot.childNodes : document.getElementById('root');\n};\n/**\n * Handle A11yContext events.\n * Because the event are sent without manual check, we split calls\n */\n\n\nvar handleRequest = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(storyId) {\n    var _yield$getParams, manual;\n\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getParams(storyId);\n\n          case 2:\n            _yield$getParams = _context.sent;\n            manual = _yield$getParams.manual;\n\n            if (manual) {\n              _context.next = 7;\n              break;\n            }\n\n            _context.next = 7;\n            return run(storyId);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function handleRequest(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar run = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(storyId) {\n    var input, axe, _input$element, element, config, _input$options, options, result;\n\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            activeStoryId = storyId;\n            _context2.prev = 1;\n            _context2.next = 4;\n            return getParams(storyId);\n\n          case 4:\n            input = _context2.sent;\n\n            if (active) {\n              _context2.next = 18;\n              break;\n            }\n\n            active = true;\n            channel.emit(EVENTS.RUNNING);\n            _context2.next = 10;\n            return import('axe-core');\n\n          case 10:\n            axe = _context2.sent;\n            _input$element = input.element, element = _input$element === void 0 ? getElement() : _input$element, config = input.config, _input$options = input.options, options = _input$options === void 0 ? {} : _input$options;\n            axe.reset();\n\n            if (config) {\n              axe.configure(config);\n            }\n\n            _context2.next = 16;\n            return axe.run(element, options);\n\n          case 16:\n            result = _context2.sent;\n\n            // It's possible that we requested a new run on a different story.\n            // Unfortunately, axe doesn't support a cancel method to abort current run.\n            // We check if the story we run against is still the current one,\n            // if not, trigger a new run using the current story\n            if (activeStoryId === storyId) {\n              channel.emit(EVENTS.RESULT, result);\n            } else {\n              active = false;\n              run(activeStoryId);\n            }\n\n          case 18:\n            _context2.next = 23;\n            break;\n\n          case 20:\n            _context2.prev = 20;\n            _context2.t0 = _context2[\"catch\"](1);\n            channel.emit(EVENTS.ERROR, _context2.t0);\n\n          case 23:\n            _context2.prev = 23;\n            active = false;\n            return _context2.finish(23);\n\n          case 26:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[1, 20, 23, 26]]);\n  }));\n\n  return function run(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n/** Returns story parameters or default ones. */\n\n\nvar getParams = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(storyId) {\n    var _ref4, parameters;\n\n    return regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return globalWindow.__STORYBOOK_STORY_STORE__.loadStory({\n              storyId: storyId\n            });\n\n          case 2:\n            _context3.t0 = _context3.sent;\n\n            if (_context3.t0) {\n              _context3.next = 5;\n              break;\n            }\n\n            _context3.t0 = {};\n\n          case 5:\n            _ref4 = _context3.t0;\n            parameters = _ref4.parameters;\n            return _context3.abrupt(\"return\", parameters.a11y || {\n              config: {},\n              options: {\n                restoreScroll: true\n              }\n            });\n\n          case 8:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getParams(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nchannel.on(EVENTS.REQUEST, handleRequest);\nchannel.on(EVENTS.MANUAL, run);"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","_asyncToGenerator","fn","self","args","err","document","global","globalWindow","module","channel","addons","active","activeStoryId","getElement","storyRoot","handleRequest","_ref","_callee","storyId","_yield$getParams","manual","_context","getParams","run","_x","_ref2","_callee2","input","axe","_input$element","element","config","_input$options","options","result","_context2","EVENTS","n","_x2","_ref3","_callee3","_ref4","parameters","_context3","_x3"],"mappings":"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"}